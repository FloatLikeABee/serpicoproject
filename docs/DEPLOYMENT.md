# Deployment Guide - Render

This guide explains how to deploy Serpico to Render as static sites (frontends) and a web service (backend).

## Prerequisites

- GitHub/GitLab repository with your code
- Render account
- Backend API URL (you'll get this after deploying the backend)

## Deployment Steps

### 1. Backend Deployment (Web Service)

1. In Render dashboard, create a new **Web Service**
2. Connect your repository
3. Configure:
   - **Name**: `serpico-backend`
   - **Environment**: `Go`
   - **Root Directory**: `backend`
   - **Build Command**: `go mod download && go build -o serpico .`
   - **Start Command**: `./serpico`
4. Add Environment Variables:
   - `PORT` - Auto-generated by Render
   - `GEMINI_API_KEY` - Your Gemini API key: `AIzaSyAt19tBj232GyyUbM95MlZzZarqZcTKmsc`
   - `GEMINI_DEFAULT_MODEL` - `gemini-2.5-flash`
   - `RAG_DATA_PATH` - `./data/rag`
   - `ENABLE_WEB_SEARCH` - `true`
5. Deploy and note the backend URL (e.g., `https://serpico-backend.onrender.com`)

### 2. Main Frontend Deployment (Static Site)

1. In Render dashboard, create a new **Static Site**
2. Connect your repository
3. Configure:
   - **Name**: `serpico-frontend`
   - **Root Directory**: `frontend`
   - **Build Command**: `npm install && npm run build`
   - **Publish Directory**: `build`
4. Add Environment Variable:
   - `REACT_APP_API_URL` - `https://your-backend-url.onrender.com/api/v1`
   - Replace `your-backend-url` with your actual backend URL from step 1
5. Deploy

### 3. Admin Frontend Deployment (Static Site)

1. In Render dashboard, create a new **Static Site**
2. Connect your repository
3. Configure:
   - **Name**: `serpico-admin`
   - **Root Directory**: `admin-frontend`
   - **Build Command**: `npm install && npm run build`
   - **Publish Directory**: `build`
4. Add Environment Variable:
   - `REACT_APP_API_URL` - `https://your-backend-url.onrender.com/api/v1`
   - Replace `your-backend-url` with your actual backend URL from step 1
5. Deploy

### 4. Update Backend CORS

After deploying the frontends, update the backend CORS middleware to allow the Render frontend URLs:

1. Go to your backend service in Render
2. Add environment variables or update the CORS middleware code to include:
   - Your main frontend Render URL
   - Your admin frontend Render URL

Or update `backend/internal/middleware/cors.go` to allow all origins (already configured).

## Using render.yaml (Alternative)

If you prefer using `render.yaml`:

1. Push `render.yaml` to your repository root
2. In Render, you can import the configuration
3. Still need to set environment variables manually in the dashboard:
   - `REACT_APP_API_URL` for both frontends
   - `GEMINI_API_KEY` for backend

## Important Notes

- **Build Time**: First build may take 5-10 minutes
- **Environment Variables**: Must be set in Render dashboard (not just in code)
- **CORS**: Backend CORS is configured to allow all origins, but verify it works with your Render URLs
- **Database**: SQLite database is stored in `backend/data/` - this persists on Render's filesystem
- **Health Checks**: Both frontends will ping `/health` every 2 minutes

## URLs After Deployment

- Main Frontend: `https://serpico-frontend.onrender.com`
- Admin Frontend: `https://serpico-admin.onrender.com`
- Backend API: `https://serpico-backend.onrender.com`
- Swagger UI: `https://serpico-backend.onrender.com/swagger/index.html`

## Troubleshooting

- **Build fails**: Check Node.js version (Render uses Node 18+ by default)
- **CORS errors**: Verify backend CORS allows your frontend URLs
- **API not found**: Check `REACT_APP_API_URL` is set correctly
- **Routing issues**: Ensure `_redirects` files are in `public/` directories

